<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Alberto Dorantes D., Ph.D.">

<title>Workshop 7, Advanced AI - Statistics Module</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Workshop07_files/libs/clipboard/clipboard.min.js"></script>
<script src="Workshop07_files/libs/quarto-html/quarto.js"></script>
<script src="Workshop07_files/libs/quarto-html/popper.min.js"></script>
<script src="Workshop07_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Workshop07_files/libs/quarto-html/anchor.min.js"></script>
<link href="Workshop07_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Workshop07_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Workshop07_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Workshop07_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Workshop07_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Content</h2>
   
  <ul>
  <li><a href="#introduction-to-time-series" id="toc-introduction-to-time-series" class="nav-link active" data-scroll-target="#introduction-to-time-series"><span class="header-section-number">1</span> Introduction to Time Series</a></li>
  <li><a href="#non-stationary-variables---the-random-walk-model-for-stock-prices" id="toc-non-stationary-variables---the-random-walk-model-for-stock-prices" class="nav-link" data-scroll-target="#non-stationary-variables---the-random-walk-model-for-stock-prices"><span class="header-section-number">2</span> Non stationary variables - The Random Walk model for stock prices</a></li>
  <li><a href="#monte-carlo-simulationfor-the-random-walk-model" id="toc-monte-carlo-simulationfor-the-random-walk-model" class="nav-link" data-scroll-target="#monte-carlo-simulationfor-the-random-walk-model"><span class="header-section-number">3</span> Monte Carlo simulationfor the random walk model</a>
  <ul>
  <li><a href="#downloading-data-for-the-sp500" id="toc-downloading-data-for-the-sp500" class="nav-link" data-scroll-target="#downloading-data-for-the-sp500"><span class="header-section-number">3.1</span> Downloading data for the S&amp;P500</a></li>
  <li><a href="#estimating-the-parameters-of-the-random-walk-model" id="toc-estimating-the-parameters-of-the-random-walk-model" class="nav-link" data-scroll-target="#estimating-the-parameters-of-the-random-walk-model"><span class="header-section-number">3.2</span> Estimating the parameters of the random walk model</a>
  <ul class="collapse">
  <li><a href="#simulating-the-random-walk-with-drift" id="toc-simulating-the-random-walk-with-drift" class="nav-link" data-scroll-target="#simulating-the-random-walk-with-drift"><span class="header-section-number">3.2.1</span> Simulating the random walk with drift</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">4</span> References</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Workshop 7, Advanced AI - Statistics Module</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Alberto Dorantes D., Ph.D. </p>
          </div>
  </div>
    
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="abstract-title">Abstract</div>
    In this workshop we learn the basics of time series regression models.
  </div>
</div>

</header>

<section id="introduction-to-time-series" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction to Time Series</h1>
<p>A time series is a variable that measures an attribute of a subject over time. For example, the daily stock price of a firm from 2010 to date.</p>
<p>We can observe several patterns or components of a time series:</p>
<ol type="a">
<li><p>if the series has a clear growing or declining trend (trend),</p></li>
<li><p>if the series has systematic changes in seasons of the year (seasonality),</p></li>
<li><p>if the series shows cycles longer than a year (cycles), and</p></li>
<li><p>if the series has irregular or idiosyncratic movements (irregular) that makes the series unpredictable.</p></li>
</ol>
<p>The first 3 components can be predicted statistically with a time-series econometric model. However, the irregularity component is unpredictable, but it can be modeled as a random “shock” that behaves similar to a normal distributed variable with a specific standard deviation and a mean equal to zero. The random shock has random negative and positive movements that makes the series move in an unpredictable way.</p>
</section>
<section id="non-stationary-variables---the-random-walk-model-for-stock-prices" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Non stationary variables - The Random Walk model for stock prices</h1>
<p>The random walk hypothesis in Finance (Fama, 1965) states that the natural logarithm of stock prices behaves like a random walk with a drift. A random walk is a series (or variable) that cannot be predicted. Imagine that <span class="math inline">\(Y_t\)</span> is the log price of a stock for today (t). The value of Y for tomorrow (<span class="math inline">\(Y_{t+1}\)</span>) will be equal to its today’s value (<span class="math inline">\(Y_t\)</span>) plus a constant value (<span class="math inline">\(φ_0\)</span>) plus a random shock. This shock is a pure random value that follows a normal distribution with mean=0 and a specific standard deviation <span class="math inline">\(σ_ε\)</span>. The process is supposed to be the same for all future periods. In mathematical terms, the random walk model is the following:</p>
<p><span class="math display">\[ Y_t = φ_0 + Y_{t−1} + ε_t \]</span></p>
<p>The <span class="math inline">\(ε_t\)</span> is a random shock for each day, which is the result of the log price movement due to all news (external and internal to the stock) that influence the price. <span class="math inline">\(φ_0\)</span> refers as the drift of the series. If <span class="math inline">\(|φ_0|\)</span> &gt; 0 we say that the series is a random walk with a drift. If <span class="math inline">\(φ_0\)</span> is positive, then the variable will have a positive trend over time; if it is negative, the series will have a negative trend.</p>
<p>If we want to simulate a random walk, we need the values of the following parameters/variables:</p>
<ul>
<li><span class="math inline">\(Y_0\)</span>, the first value of the series</li>
<li><span class="math inline">\(φ_0\)</span>, the drift of the series</li>
<li><span class="math inline">\(σ_ε\)</span>, the standard deviation (volatility) of the random shock</li>
</ul>
</section>
<section id="monte-carlo-simulationfor-the-random-walk-model" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Monte Carlo simulationfor the random walk model</h1>
<p>Let’s go and run a MonteCarlo simulation for a random walk of the S&amp;P 500. We will use real values of the S&amp;P500 to estimate the previous 3 parameters.</p>
<section id="downloading-data-for-the-sp500" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="downloading-data-for-the-sp500"><span class="header-section-number">3.1</span> Downloading data for the S&amp;P500</h2>
<p>We download the S&amp;P500 historical daily data from Yahoo Finance from 2009 to date (Sep 30, 2022).</p>
<p>I download the S&amp;P500 index from Yahoo Finance!</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yfinance <span class="im">as</span> yf</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> date</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statistics <span class="im">as</span> st</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>sp500<span class="op">=</span>yf.download(tickers<span class="op">=</span><span class="st">"^GSPC"</span>, start<span class="op">=</span><span class="st">"2009-01-01"</span>,interval<span class="op">=</span><span class="st">"1d"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># I keep the adj close column:</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>sp500<span class="op">=</span>sp500[<span class="st">'Adj Close'</span>]</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>sp500</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[*********************100%%**********************]  1 of 1 completed</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Date
2009-01-02     931.799988
2009-01-05     927.450012
2009-01-06     934.700012
2009-01-07     906.650024
2009-01-08     909.729980
                 ...     
2023-10-05    4258.189941
2023-10-06    4308.500000
2023-10-09    4335.660156
2023-10-10    4358.240234
2023-10-11    4376.950195
Name: Adj Close, Length: 3719, dtype: float64</code></pre>
</div>
</div>
<p>Now we generate the log of the S&amp;P index using the closing price/quotation, and create a variable N for the number of days in the dataset:</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>lnsp500 <span class="op">=</span> np.log(sp500)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>lnsp500</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># N will be the # of days in the series</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="bu">len</span>(lnsp500)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>N</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>3719</code></pre>
</div>
</div>
<p>Now we will simulate 2 random walk series estimating the 3 parameters from this log series of the S&amp;P500:</p>
<ol type="a">
<li><p>random walk with a drift (name it rw1), and</p></li>
<li><p>random walk with no drift (name it rw2).</p></li>
</ol>
</section>
<section id="estimating-the-parameters-of-the-random-walk-model" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="estimating-the-parameters-of-the-random-walk-model"><span class="header-section-number">3.2</span> Estimating the parameters of the random walk model</h2>
<p>We have to consider the mathematical definition of a random walk and estimate its parameters (initial value, phi0, volatility of the random shock) from the real daily S&amp;P500 data.</p>
<p>Now, we create a variable for a random walk with a drift trying to model the log of the S&amp;P500.</p>
<p>Reviewing the random walk equation again:</p>
<p><span class="math display">\[ Y_t = φ_0 + Y_{t−1} + ε_t \]</span> <strong>The</strong> <span class="math inline">\(ε_t\)</span> is the <em>random shock</em> of each day, which represents the overall average perception of all market participants after learning the news of the day (internal and external news announced to the market).</p>
<p>Remember that <span class="math inline">\(\varepsilon_{t}\)</span> behaves like a random normal distributed variable with mean=0 and with a specific standard deviation <span class="math inline">\(\sigma_{\varepsilon}\)</span>.</p>
<p>For the simulation of the random walk, you need to estimate the values of</p>
<ul>
<li><p><span class="math inline">\(y_{0}\)</span>, the first value of the series, which is the log S&amp;P500 index of the first day</p></li>
<li><p><span class="math inline">\(\phi_{0}\)</span></p></li>
<li><p><span class="math inline">\(\sigma_{\varepsilon}\)</span></p></li>
</ul>
<p>You have to estimate <span class="math inline">\(\phi_{0}\)</span> using the last and the first real values of the series following the equation of the random walk. Here you can see possible values of a random walk over time:</p>
<p><span class="math display">\[
    Y_{0} = Initial value
\]</span> <span class="math display">\[  
    Y_{1} = \phi_{0} + Y_{0} + \varepsilon_{1}
\]</span> <span class="math display">\[  
    Y_{2} = \phi_{0} + Y_{1} + \varepsilon_{2}
\]</span> Substituting <span class="math inline">\(Y_{1}\)</span> with its corresponding equation: <span class="math display">\[
    Y_{2} = \phi_{0} + \phi_{0} + Y_{0} + \varepsilon_{1} + \varepsilon_{2}
\]</span> Re-arranging the terms: <span class="math display">\[
    Y_{2} = 2*\phi_{0} + Y_{0} + \varepsilon_{1} + \varepsilon_{2}
\]</span> If you continue doing the same until the last N value, you can get: <span class="math display">\[
    Y_{N} = N*\phi_{0} + Y_{0} + \sum_{t=1}^{N}\varepsilon_{t}
\]</span></p>
<p>This mathematical result is kind of intuitive. The value of a random walk at time N will be equal to its initial value plus N times phi0 plus the sum of ALL random shocks from 1 to N.</p>
<p>Since the mean of the shocks is assumed to be zero, then the expected value of the sum of the shocks will also be zero. Then: <span class="math display">\[
    E[Y_{N}] = N*\phi_{0} + Y_{0}
\]</span> From this equation we see that <span class="math inline">\(phi_{0}\)</span> can be estimated as: <span class="math display">\[
    \phi_{0} = \frac{(Y_{N} - Y_{0})}{N}
\]</span></p>
<p>Then, <span class="math inline">\(\phi_{0}\)</span> = (last value - first value) / # of days.</p>
<p>I use scalars to calculate these coefficients for the simulation. A Stata scalar is a temporal variable to save a number.</p>
<p>I calculate <span class="math inline">\(\phi_{0}\)</span> following this formula:</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>phi0 <span class="op">=</span> (lnsp500[<span class="op">-</span><span class="dv">1</span>] <span class="op">-</span> lnsp500[<span class="dv">1</span>]) <span class="op">/</span> N</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The -1 location of the lnsp500 is actually the last value of the lnsp500 series </span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>phi0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>0.00041722736234597315</code></pre>
</div>
</div>
<p>Remember that N is the total # of observations, so lnsp500[N-1] has last daily value of the log of the S&amp;P500 since the first element is in the 0 location.</p>
<p>Now we need to estimate sigma, which is the standard deviation of the shocks. We can start estimating its variance first. It is known that the variance of a random walk cannot be determined unless we consider a specific number of periods.</p>
<p>Then, let’s consider the equation of the random walk series for the last value (<span class="math inline">\(Y_N\)</span>), and then estimate its variance from there:</p>
<p><span class="math display">\[
    Y_{N} = N*\phi_{0} + Y_{0} + \sum_{t=1}^{N}\varepsilon_{t}
\]</span> Using this equation, we calculate the variance of <span class="math inline">\(Y_N\)</span> :</p>
<p><span class="math display">\[
    Var(Y_{N}) = Var(N*\phi_{0}) + Var(Y_{0}) + \sum_{t=1}^{N}Var(\varepsilon_{t})
\]</span> The variance of a constant is zero, so the first two terms are equal to zero.</p>
<p>Now analize the variance of the shock:</p>
<p>Since it is supposed that the volatility (standard deviation) of the shocks is about the same over time, then:</p>
<p><span class="math display">\[
    Var(\varepsilon_{1}) = Var(\varepsilon_{2}) = Var(\varepsilon_{N}) = \sigma_{\varepsilon}^2
\]</span> Then the sum of the variances of all shocks is actually the variance of the shock times N. Then the variance of all the shocks is actually the variance of <span class="math inline">\(Y_N\)</span>.</p>
<p>Then we can write the variance of <span class="math inline">\(Y_N\)</span> as:</p>
<p><span class="math display">\[
    Var(Y_{N}) = N * Var(\varepsilon)= N*\sigma_{\varepsilon}^2
\]</span> To get the standard deviation of <span class="math inline">\(Y_N\)</span> we take the square root of the variance of <span class="math inline">\(Y_N\)</span>:</p>
<p><span class="math display">\[  
    SD(Y_{N}) = \sqrt{N}*SD(\varepsilon)
\]</span> We use sigma character for standard deviations:</p>
<p><span class="math display">\[  
    \sigma_{Y} = \sqrt{N}*\sigma_{\varepsilon}
\]</span><br>
Finally we express the volatility of the shock (<span class="math inline">\(\sigma_{\varepsilon}\)</span>) in terms of the volatility of <span class="math inline">\(Y_N\)</span> (<span class="math inline">\(\sigma_{Y}\)</span>):</p>
<p><span class="math display">\[
    \sigma_{\varepsilon} = \frac{\sigma_{Y}}{\sqrt{N}}
\]</span></p>
<p>Then we can estimate sigma as: sigma = StDev(lnsp) / sqrt(N). Let’s do it:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> np.std(lnsp500)<span class="op">/</span>np.sqrt(N)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>sigma</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>0.00771621174469844</code></pre>
</div>
</div>
<p>The volatility for the shock is <code>python sigma</code></p>
<p>The volatility for lnsp500 series is <code>python np.std(lnsp500)</code>.</p>
<section id="simulating-the-random-walk-with-drift" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="simulating-the-random-walk-with-drift"><span class="header-section-number">3.2.1</span> Simulating the random walk with drift</h3>
<p>Now you are ready to start the simulation of random walk using rw1:</p>
<p><span class="math display">\[
    rw1_{t} = \phi_{0} + rw1_{t-1} + \varepsilon_{t}
\]</span></p>
<p>The <span class="math inline">\(\phi_{0}\)</span> coefficient is also <strong>drift</strong> of the random walk.</p>
<p>We will create a new column in the lnsp R dataset for the random walk with the name rw1.</p>
<p>I start assigning the first value of the random walk to be equal to the first value of the log of the S&amp;P500:</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># I initialize the random walk array with zeros:</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>rw1 <span class="op">=</span> np.zeros(N)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># I set the first value equal to the real log value:</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>rw1[<span class="dv">0</span>] <span class="op">=</span> lnsp500[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now assign random values from day 2 to the last day following the random walk. For each day, we create the random shock using the function random.normal. We create this shock with standard deviation equal to the volatility of the shock we calculated above (the sigma). We indicate that the mean = 0:</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>shock <span class="op">=</span> np.random.normal(<span class="dv">0</span>,sigma,N)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we are ready to start the simulation of random walk. Then we fill the values for rw1. Remembering the formula for the random walk process:</p>
<p><span class="math display">\[
    rw1_{t} = \phi_{0} + rw1_{t-1} + \varepsilon_{t}
\]</span></p>
<p>We start the random walk with the first value of the log of the S&amp;P500. Then, from day 2 we do the simulation according to the previous formula and using the random shock just created:</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,N):</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  rw1[k] <span class="op">=</span> rw1[k<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> phi0 <span class="op">+</span> shock[k]</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Another way to do the same using the np.cumsum function instead of a for loop: </span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> np.arange(<span class="dv">0</span>,N,<span class="dv">1</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># i is an array from 0 to N-1</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># I set the first shock to avoid summing this shock with the cumsum function</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>shock[<span class="dv">0</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>rw2<span class="op">=</span> lnsp500[<span class="dv">0</span>] <span class="op">+</span> i<span class="op">*</span>phi0 <span class="op">+</span> np.cumsum(shock)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># The result is the same as rw1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I plot the simulated random walk and the real log of the S&amp;P500:</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.pyplot <span class="im">import</span><span class="op">*</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">#I turn the log of the S&amp;P500 variable into a dataframe</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>lnsp500<span class="op">=</span>pd.DataFrame(lnsp500)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">#I add the random walk values in a new column</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>lnsp500[<span class="st">'rw1'</span>]<span class="op">=</span>rw1</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>lnsp500</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>plot(lnsp500[<span class="st">'Adj Close'</span>], color<span class="op">=</span><span class="st">'r'</span>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>plot(lnsp500[<span class="st">'rw1'</span>], color<span class="op">=</span><span class="st">'b'</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>legend([<span class="st">'original s&amp;p500 price'</span>, <span class="st">'Random walk with a drift'</span>], loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Workshop07_files/figure-html/cell-9-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
</section>
<section id="references" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> References</h1>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>